<!doctype html>
<html lang="">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="favicon.ico" rel="shortcut icon" type="image/ico">
    <title>Angular Augury</title>

    <!-- Material Design icons -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,300,500,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="vendors/material-design-lite/material.min.css">
    <link rel="stylesheet" href="styles/main.css">
</head>
<body class="mdl-demo mdl-base">
<p><img src="images/form-empty.png" alt="Image Empty Form"></p>
<p><a href="https://augury.angular.io/examples/dependency-injection/app/" target="blank">Launch Demo Application</a></p>
<h2>Description</h2><p>The <em>Dependency Injection</em> application exemplifies using a simple Angular <em>template</em> based <em>Form</em> that uses a data <em>service</em> to hold the submitted data. The data <em>service</em> provides a data <em>stream</em> to publish updates. A view <em>component</em> subscribes to the data <em>stream</em> and displays the most recent submitted user data in table format.</p>
<p>To display the <em>User</em> data table, enter values in the <em>Form</em> and click on the <em>Create</em> button.</p>
<p><img src="images/form-entry.png" alt="Image User Data Entry"></p>
<p>This will result in the data getting sent the <em>data service</em> which then broadcasts the new data. The data view <em>component</em> listens for updates from the data <em>service</em> and presents the most recent data in a <em>table</em> like the following.</p>
<p><img src="images/form-with-table.png" alt="Image Table View">.</p>
<h2>Application Structure</h2><p>The <em>Dependency Injection</em> application is composed of 3 <em>components</em> and 1 <em>service</em>.</p>
<h3>Components</h3><ol>
<li>AppComponent</li>
<li>FormNewUserComponent</li>
<li>UserInfoComponet</li>
</ol>
<h3>Service</h3><ul>
<li>NewUserService</li>
</ul>
<h2>Architecture</h2><p>The Angular application makes use of <em>RxJS</em> to create a data <em>stream</em> to publish the <em>user</em> data. When the <em>Create</em> button is clicked, the user data is sent to the <em>service</em> using an API call. The <em>service</em> then publishes the data using an <em>RxJS Subject</em>.</p>
<p><img src="images/app-uml.png" alt="Image App UML"></p>
<p>The HTML Form is provided by <em>component</em> <code>FormNewUserComponent</code>. The table view of the user info is handled by <code>UserInfoComponent</code>. It simply subscribes to the <em>Subject</em> publishing the user data.</p>
<h2>Opening Augury</h2><p>To use Augury, we must open DevTools first with the following keyboard shortcut.</p>
<pre><code>Ctrl + Shift + I (Cmd + Opt + I on Mac)
</code></pre><p>When DevTools opens, select the <strong>Augury</strong> tab located on the far right. In DevTools, under the <em>Component Tree</em> tab, you will see the following parent and children tree relationship for Angular <em>components</em> and any HTML DOM <em>elements</em>.</p>
<p><img src="images/component-tree.png" alt="Image Component Tree"></p>
<p>The default view setting, called the <em>Hybrid view</em>, can be changed from the settings.</p>
<p><img src="images/component-tree-view-setting.png" alt="Image Component Tree View Settings"></p>
<h2>Component View</h2><p>Augury shows that the <em>Dependency Injection</em> Angular application has 3 components. The <em>Root</em> component is called <code>AppComponent</code> which in turn contains 2 child components, <code>UserInfoComponent</code> and <code>FormNewUserComponent</code>.</p>
<p>Select <code>AppComponent</code> from the <em>Component Tree</em>, on the right side in the <em>Properties</em> tab, we see the single property <code>title</code> under <em>State</em>. Augury allows the value of property <code>title</code> to be modified. This is indicated by displaying an edit field with a dashed blue line on the bottom.</p>
<p><img src="images/app-title.png" alt="Image App Title Property"></p>
<p>Feel free to change the value and press the <em>Enter</em> key to see the change get reflected in the Web page.</p>
<h2>Viewing Source Code</h2><p>In the <em>Properties</em> tab, next to the name of the <em>component</em> you will notice a clickable link called <code>(View Source)</code>. By clicking on it, DevTools will switch to the <em>Sources</em> tab to show the TypeScript code of the selected <em>component</em>.</p>
<p><img src="images/devtools-sources.png" alt="Image DevTool Sources">.</p>
<p>In the TypeScript code, you see <code>title</code> property assignment, which is what is displayed in Augury&#39;s <em>Properties</em> tab.</p>
<pre><code class="language-js"> title = &#39;Angular Form: New User&#39;;
</code></pre>
<p>To return to Augury, click on the Augury tab.</p>
<h2>Dependency</h2><p>Let us take a look at the <code>UserInfoComponent</code>, select it from the <em>Component Tree</em>. In the <em>Properties</em> tab, we see that under <em>State</em>, the component has only one property <code>newUserService</code> and one dependency to <code>NewUserService</code>.</p>
<p><img src="images/user-info-component.png" alt="Image User Info Component"></p>
<p>If we take a look at the source code, the class for the component actually has 2 members (properties), <code>userInfo</code> and <code>newUserService</code>.</p>
<pre><code class="language-js">export class UserInfoComponent {

  userInfo;

  constructor( private newUserService: NewUserService ) {
    this.newUserService.getStream().subscribe(
      data =&gt; this.userInfo = data
    );
  }

}
</code></pre>
<p>Since property <code>userInfo</code> is not assigned a value, TypeScript removes it during compile, this is why the property is not seen in the <em>Properties</em> tab. Likewise <code>newUserService</code> is assigned a value (a reference to the service) by the <em>Injector</em> using Angular&#39;s Dependency Injection (DI).</p>
<p>Let us <em>publish</em> a hand crafted user info using Augury. In the <em>Properties</em> tab, under <em>State</em> expand property <code>newUserService</code> as shown below so the <em>Emit</em> button is visible.</p>
<p>Type in a JavaScript object with the fields, <em>name</em>, <em>email</em> and <em>password</em> containing some value.</p>
<p><img src="images/emit-user-info.png" alt="Image User Info Emit"></p>
<p>When this data has been emitted, you will see this data displayed by the <code>UserInfoComponent</code> in a table.</p>
<p><img src="images/emit-user-info-table.png" alt="Image User Info Emit Table"></p>
<p>In the <em>Properties</em> tab, the <em>State</em> should now look like this.</p>
<p><img src="images/emitted-user-info-properties.png" alt="Image Emitted User Info Properties"></p>
<p>Since the <code>surname</code> field was left out from the emitted user info data, it shows up empty in the table on the Web page. Likewise it&#39;s missing under <em>State</em> for object <code>userInfo</code>.</p>
<h2>Injector Graph</h2><p>Besides looking at the source code to determine dependencies, Augury provides a visual way to see this through the <em>Injector Graph</em> tab located next to the <em>Properties</em> tab. If we select it, we will see a dependency tree.</p>
<p><img src="images/user-info-injector-graph.png" alt="Image User Info Injector Graph"></p>
<p>For this new information to be useful, you need to understand how the <em>Injector</em> graph is generated. It does not show the graph for the entire application. What gets shown is the dependency of the selected <em>component</em> and its ancestry chain to the <em>Root injector</em>.</p>
<p>Further reading material of the <a href="https://angular.io/docs/ts/latest/guide/hierarchical-dependency-injection.html">Injector Dependency Tree</a> can be found in the Angular guide.</p>
<h3>Understanding The Graph</h3><p>Let us look at how to read the <em>Injector</em> graph. At the top we have the <em>Root injector</em>, which is found in the <code>NgModule</code> at the root of the application.</p>
<p>In the code, looking at file <code>app.module.ts</code> we see 3 <em>components</em> being declared by the root module as well as the one <em>service</em> <code>NewUserService</code> that is registered with the <em>Root injector</em>.</p>
<pre><code class="language-js">@NgModule({
  declarations: [
    AppComponent,
    FormNewUserComponent,
    UserInfoComponent
  ],
  imports: [
    BrowserModule,
    FormsModule,
    HttpModule
  ],
  providers: [NewUserService ],
  bootstrap: [AppComponent]
})
export class AppModule { }
</code></pre>
<p>Looking at the graph, we see that <code>UserInfoComponent</code> is projected by <code>AppComponent</code>, the parent <em>component</em>. This is obvious if we look at the code (<code>app.component.ts</code>), in the <em>template</em> string we see <code>&lt;app-user-info&gt;</code> being used.</p>
<pre><code class="language-js">@Component({
  selector: &#39;app-root&#39;,
  template: `
...
    &lt;div class=&quot;pt3&quot;&gt;
      &lt;app-user-info&gt;&lt;/app-user-info&gt;
    &lt;/div&gt;
...
`
})
export class AppComponent {
  title = &#39;Angular Form: New User&#39;;
}
</code></pre>
<p>Looking next at <code>UserInfoComponent</code>, we see a red line extending to the right, connecting to a circle labeled <code>NewUserService</code>. This denotes that <em>service</em> <code>NewUserService</code> is being injected into <em>component</em> <code>UserInfoComponent</code>.</p>
<p>The dashed blue line from the <em>Root injector</em> to <code>NewUserService</code> indicates this <em>service</em> is provided by the <em>Root injector</em>. This identifies the <em>service</em> as being a <em>singleton</em> (a global shared instance), that is available throughout the entire application.</p>
<h3>Colours</h3><p>Pay close attention to the colours of the <em>components</em> and <em>service</em>. For example, the circle is hollow for <em>service</em>. This means the <em>service</em> is not provided by the <em>component</em>, instead it is being provided from an ancestor in the dependency tree.</p>
<h3>Parent Level Injector</h3><p>Let us play around with <em>service</em> registration. Instead of the <em>service</em> being provided by the <em>Root</em> injector, we are going to override this behaviour. Let us have <code>AppComponent</code> register the <em>service</em> being used by <code>UserInfoComponent</code>. Open the file <code>app.component.ts</code> and add a <code>providers</code> array and <code>import</code> like this:</p>
<pre><code class="language-js">import { NewUserService  } from &#39;./new-user.service&#39;;

@Component({
  providers: [NewUserService ],
  selector: &#39;app-root&#39;,
  ...
</code></pre>
<p>Now the <em>Injector</em> graph looks like this:</p>
<p><img src="images/user-info-injector-graph-1.png" alt="Image User Info Injector Graph"></p>
<p>The only thing that has changed is the dashed blue line, coming from <code>AppComponent</code> to the <em>service</em>. This as we should know now, indicates <code>NewUserService</code> is coming from the parent <em>injector</em> of <code>AppComponent</code>.</p>
<h3>Component Level Injector</h3><p>A <em>service</em> can also be injected at the <em>component</em> level. To see how this would look from the <em>Injector Graph</em>, we can make a simple code alteration to <code>UserInfoComponent</code> in the file <code>user-info.component.ts</code>.</p>
<p>In the <code>@Component</code> decorator, include the <code>providers</code> array like this:</p>
<pre><code class="language-js">@Component({
  providers: [NewUserService ],
  selector: &#39;app-user-info&#39;,
  template: `
  ...
})
</code></pre>
<p>If we now look at the <em>Injector Graph</em>, we will see the dashed line has disappeared.</p>
<p><img src="images/user-info-injector-graph-2.png" alt="Image User Info Injector Graph"></p>
<p>The <code>NewUserService</code> is being injected into <code>UserInfoComponent</code> as well as being registered with <code>UserInfoComponent</code>. Pay attention to the ball in the graph for the <em>service</em>, it has now become filled.</p>
<p><strong>Note</strong>: These changes will break the code as the application no longer uses the same <code>singleton</code> <em>service</em> to communicate data. This was for demonstration purpose only for the <em>Injector Graph</em>.</p>
<script src="tools/prism.js"></script>
<script src="vendors/material-design-lite/material.min.js"></script>
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-8594346-15', 'auto');
    ga('send', 'pageview');
</script>
<script>
    var trackOutboundLinkNav = function(url) {
      ga('send', 'event', 'acquisition', 'install', 'nav', {
        'transport': 'beacon',
        'hitCallback': function(){document.location = url;}
      });
    }

    var trackOutboundLinkHero = function(url) {
      ga('send', 'event', 'acquisition', 'install', 'hero', {
        'transport': 'beacon',
        'hitCallback': function(){document.location = url;}
      });
    }

    var trackOutboundLinkCta = function(url) {
      ga('send', 'event', 'acquisition', 'install', 'cta', {
        'transport': 'beacon',
        'hitCallback': function(){document.location = url;}
      });
    }
</script>
</body>
</html>
